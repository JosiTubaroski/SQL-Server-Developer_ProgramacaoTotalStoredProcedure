/*
Na aula passada vimos que é possível enviar um conjunto de dados
para a procedure. Como uma procedure pode receber vários parâmetros,
voce pode enviar vários conjuntos de dados distintos, cada um para 
um determinado parâmetro. 

Mas como retornar da procedures, vários conjuntos de dados distintos?

Essa aula foi criada com base em um post da RedGate Software recente. 
Segue o link 

https://www.red-gate.com/simple-talk/blogs/using-stored-procedures-sql-server-return-several-results/

O conteúdo bem permitente é de facil implementação. Vamos as explicações.

Nativamente, o SQL Server não implementa uma solução para retornar
diversos conjunto de dados ao término da execução da procedure. 

E os parâmetros de saida não aceitam tipos de dados tabela e eles
são sempre READONLY.

Uma outra forma de manipular conjunto de dados é através de XML que é 
nativo do SQL Server desde a versão 2000 ou por JSON desde a versão 2016.

Ambos os formatos são utilizados para troca de dados entre plataforma 
heterogêneas como serviços web e banco de dados NoSQL por exemplo. 
*/


/*
Gerando dados XML e JSON a partir de uma tabela. 
*/

use eBook
go

Select iIDCliente, cNome, dAniversario 
  From tCADCliente
 where dAniversario > '2000-11-01'
   For XML Auto 
go 

Select iIDCliente, cNome, dAniversario 
  From tCADCliente
 where dAniversario > '2000-11-01'
   For Json Auto 
go 


/*
Incluíndo esses dados em variáveis. 
*/

Declare @xClientes xml 
Declare @jClientes varchar(max) 

Set @xClientes = (Select iIDCliente, cNome, dAniversario 
  From tCADCliente
 where dAniversario > '2000-11-01'
   For XML Auto 
   )

Set @jClientes = (Select iIDCliente, cNome, dAniversario 
  From tCADCliente
 where dAniversario > '2000-11-01'
   For Json Auto 
   )

Select @xClientes
Select @jClientes
GO

/*
Analisando somente o tipo de dados JSON 
*/

Declare @jClientes varchar(max) 
Set @jClientes = (Select iIDCliente, cNome, dAniversario 
  From tCADCliente
 where dAniversario > '2000-11-01'
   For Json Auto 
   )
--select @jClientes

Select * 
  From OpenJson (@jClientes)
  With (iIDCliente int '$.iIDCliente' , 
        cNome varchar(100) '$.cNome', 
        dAniversario datetime '$.dAniversario' 
       )
go 


/*
Então consigo colocar um conjuto de dados dentro de variáveis?
Mas as variáveis não podem ser usada como parâmetros?
Então posso passar um conjunto de dados sem ser por parâmetro de tabelas?
Com isso eu consigo retornar um conjunto de dados?
*/
use eBook
go

/*------------------------------------------------------------
Autor      : Wolney M. Maia
Objeto     : stp_AtualizaEstoque 
Objetivo   : Atualiza a quantidade e valor de vários livros para uma
             determinada loja. 
             Retorna um conjunto de dados com os valores atualizados
             no formato JSON 

Histórico:        
Autor                  IDBug Data       Descrição        
---------------------- ----- ---------- --------------------
Wolney M. Maia               01/01/2019 Criação da Procedure 
------------------------------------------------------------*/
Create or Alter Procedure stp_AtualizaEstoque 
@iidLoja int, 
@tAtualizaEstoque dtAtualizaEstoque READONLY,
@jEstoqueAtualizado varchar(max) OUTPUT 
as
Begin

   Set nocount on 

   Declare @nRetorno int = 0 

   Begin Try

      Update tRELEstoque 
         Set nQuantidade += tAtualizaEstoque.nQuantidade ,
             mValor = tAtualizaEstoque.mValor 
        From tRELEstoque 
        Join @tAtualizaEstoque as tAtualizaEstoque
          on tRELEstoque.iIDLivro = tAtualizaEstoque.iIDLivro
       Where tRELEstoque.iIDLoja = @iidLoja
      
      if @@rowcount = 0
         Raiserror('Não houve livros para atualizar o estoque.',16,1)

      Set @jEstoqueAtualizado = (Select Estoque.iIDLivro,
                                        Estoque.nQuantidade, Estoque.mValor
                                   From tRELEstoque as Estoque 
                                   Join @tAtualizaEstoque as tAtualizaEstoque
                                     on Estoque.iIDLivro = tAtualizaEstoque.iIDLivro
                                  Where Estoque.iIDLoja = @iidLoja
                                    For Json Auto -->> 
                                )

       
   End Try 

   Begin Catch 

      Execute @nRetorno = stp_ManipulaErro

   End Catch 

   Return @nRetorno

End 
/*
*/

/*
Para simular, vamos colocar na tabela temporária onde 
está os dados carregados da planilha. 

PS: A tabela abaixo foi criado na aula anterior. 
*/

Update tTMPAtualizaEstoque 
   Set nQuantidade += 10 , -- Aumenta a quantidade em mais 10 unidades 
       mValor *= 1.10      -- Aumente o valor em 10% 



go

Begin Transaction 

Select count(1) , sum(mValor) from tRELEstoque where iIDLoja = 20 

-- Declare a variavel tabela igual ao tipo de dados tabela. 
Declare @tTMPItensEnviados dtAtualizaEstoque 
Declare @jEstoqueRetorno varchar(max) = ''

-- Inserir os dados enviados para essa variável 
Insert Into @tTMPItensEnviados (iIDLivro,nQuantidade,mValor)
Select iIDLivro,nQuantidade,mValor 
  From tTMPAtualizaEstoque 

Declare @iidLoja int = 20 
Declare @nStatus int = 0

Execute @nStatus = stp_AtualizaEstoque  @iidLoja = @iidLoja ,
                                        @tAtualizaEstoque = @tTMPItensEnviados,
                                        @jEstoqueAtualizado = @jEstoqueRetorno  OUTPUT 

if @nStatus = 0 Begin 

   Select count(1) , sum(mValor) from tRELEstoque where iIDLoja = 20 

   Select * 
     From OpenJson (@jEstoqueRetorno)
     With (iIDLivro int '$.iIDLivro' ,
           nQuantidade int  '$.nQuantidade', 
           mValor smallmoney '$.mValor'
          )

   Commit 
End 
Else Begin 
   Rollback 
   Select * from vLOGEventos where iIDEvento = @nStatus
End 
go 



/*
Agora vamos inclur a seguintes alterações 

1. A tabela utilizada no parâmetro de valor de 
   tabela vai ter a coluna iIDLoja. Com isso, podemos fazer
   a atualização do estoque de diversas lojas.
   No exemplo, vamos atualizar as lojas 20,21 e 22

2. Vamos retornar um segundo conjunto de dados que apresenta
   o valor de estoque de cada loja. Será apresentado o nome da loja, 
   a quantidade de itens e o valor do estoque.
*/


/*
Vamos incluir a coluna iIDLoja na tabela tTMPAtualizaEstoque 
*/
Alter Table tTMPAtualizaEstoque add iidLoja int not null default 0
go

Truncate table tTMPAtualizaEstoque

/*
Dados da planilha para atualizar as lojas 20, 21 e 22.
*/

Insert into tTMPAtualizaEstoque (iIDLoja, iIDLivro, nQuantidade, mValor)
values 
(20,106,798,13.92),
(20,159,886,15.73),
(20,173,820,14.25),
(20,176,754,14.42),
(20,203,666,3.74),
(20,253,886,4.72),
(20,270,600,10.64),
(20,429,798,4.89),
(20,436,556,10.64),
(20,491,600,0.61),
(20,550,2030,8.17),
(20,560,1326,2.26),
(20,607,820,8.17),
(20,675,754,3.24),
(20,738,578,4.72),
(20,773,622,0.61),
(20,828,688,5.38),
(20,852,666,4.39),
(20,861,886,16.06),
(20,869,1062,6.04),
(20,871,600,15.07),
(20,880,952,10.80),
(20,930,688,1.27),
(20,991,578,7.19),
(20,1098,556,9.49),
(20,1147,886,1.60),
(20,1151,2514,8.83),
(20,1176,556,2.59),
(20,1233,886,4.23),
(20,1249,798,5.71),
(20,1342,952,1.11),
(20,1384,578,10.80),
(20,1403,710,13.43),
(20,1406,556,6.69),
(20,1430,1282,14.09),
(20,1456,1414,15.40),
(20,1513,798,13.59),
(20,1526,1370,3.74),
(20,1604,798,7.35),
(20,1607,1326,14.09),
(20,1683,1062,2.09),
(20,1702,886,16.55),
(20,1794,688,9.49),
(20,1806,644,3.41),
(20,1813,798,14.58),
(20,1817,2184,7.52),
(20,1876,556,13.92),
(20,1894,798,16.22),
(20,1919,1678,15.89),
(20,1990,842,9.82),
(20,2059,798,8.50),
(20,2096,688,4.39),
(20,2098,622,3.24),
(20,2105,952,12.28),
(20,2108,666,8.34),
(20,2132,754,11.95),
(20,2184,578,9.49),
(20,2194,710,14.25),
(20,2227,556,7.02),
(20,2230,1326,3.90),
(20,2232,578,14.09),
(20,2356,1018,3.74),
(20,2384,688,6.20),
(20,2406,556,3.74),
(20,2563,776,7.35),
(20,2614,952,3.90),
(20,2637,842,15.40),
(20,2698,666,10.14),
(20,2818,1018,9.65),
(20,2839,754,7.02),
(20,2867,1084,15.24),
(20,2877,556,13.10),
(20,2894,556,6.69),
(20,2900,1458,11.13),
(20,2909,688,5.71),
(20,2933,1172,3.24),
(20,2945,622,13.10),
(20,2985,952,6.86),
(20,3034,556,16.06),
(20,3070,754,5.54),
(20,3121,1348,16.06),
(20,3235,622,9.98),
(20,3259,556,1.76),
(20,3295,886,16.22),
(20,3317,952,4.72),
(20,3337,710,15.40),
(20,3349,820,3.74),
(20,3351,622,4.72),
(20,3378,776,14.09),
(20,3391,534,13.27),
(20,3396,974,10.64),
(20,3450,710,1.60),
(20,3462,1018,10.47),
(20,3506,622,5.54),
(20,3530,578,7.68),
(20,3609,688,4.56),
(20,3724,578,12.61),
(20,3730,952,7.52),
(20,3776,688,3.24),
(20,3849,1018,5.71),
(20,3860,622,1.60),
(20,3870,754,8.66),
(20,3887,688,6.36),
(20,3925,1172,1.76),
(20,3975,886,16.22),
(20,4007,710,14.42),
(20,4085,556,8.50),
(20,4134,622,1.60),
(20,4145,556,3.57),
(20,4181,1084,10.97),
(20,4225,1018,2.09),
(20,4251,754,11.95),
(20,4292,578,9.49),
(20,4305,556,5.87),
(20,4312,556,14.91),
(20,4345,798,3.08),
(20,4374,886,15.24),
(20,4411,666,10.97),
(20,4502,1062,16.06),
(20,4514,1018,5.05),
(20,4551,688,8.83),
(20,4600,622,0.61),
(20,4611,952,15.24),
(20,4622,754,9.65),
(20,4624,1128,7.19),
(20,4649,1084,13.76),
(20,4668,578,10.80),
(20,4703,600,1.93),
(20,4718,754,16.22),
(20,4745,1216,16.22),
(20,4784,578,7.35),
(20,4854,908,13.92),
(20,4867,578,6.04),
(20,4910,842,0.78),
(20,4918,600,14.74),
(20,4924,1766,9.65),
(20,4977,908,8.34),
(20,5012,578,4.56),
(20,5024,622,15.40),
(20,5089,1084,7.35),
(20,5091,600,1.11),
(20,5137,820,6.20),
(20,5173,622,6.86),
(20,5231,842,1.27),
(20,5251,1524,8.66),
(20,5264,622,9.98),
(20,5290,666,5.71),
(20,5327,1876,16.06),
(20,5388,666,2.42),
(20,5399,886,9.65),
(20,5435,754,14.58),
(20,5446,754,8.66),
(20,5458,1018,0.78),
(20,5481,886,12.12),
(20,5567,1502,14.09),
(20,5629,1018,13.43),
(20,5652,556,14.58),
(20,5678,754,6.69),
(20,5682,710,13.76),
(20,5716,820,6.86),
(20,5760,952,6.69),
(20,5772,886,0.94),
(20,5817,666,6.36),
(20,5819,886,4.06),
(20,5820,556,12.12),
(20,5866,754,4.39),
(20,5869,776,14.09),
(20,5899,886,4.89),
(20,6003,578,2.59),
(20,6039,952,5.71),
(20,6055,1018,15.57),
(20,6106,710,3.08),
(20,6115,1238,12.61),
(20,6126,1216,7.02),
(20,6173,886,14.58),
(20,6187,710,5.54),
(20,6193,622,1.93),
(20,6244,600,1.76),
(20,6281,776,9.82),
(20,6328,952,7.35),
(20,6356,578,5.71),
(20,6376,688,1.44),
(20,6454,578,14.42),
(20,6455,710,14.91),
(20,6515,622,10.31),
(20,6516,622,1.11),
(20,6521,688,13.59),
(20,6544,732,13.92),
(20,6631,1128,13.43),
(20,6637,622,8.83),
(20,6647,644,16.22),
(20,6668,556,6.69),
(20,6700,622,12.28),
(20,6733,1326,8.17),
(20,6744,600,7.84),
(20,6779,952,7.84),
(20,6870,1216,13.10),
(20,6899,622,5.71),
(20,6937,1744,7.52),
(20,7001,644,14.09),
(20,7012,556,3.08),
(20,7031,1018,6.04),
(20,7146,578,13.92),
(20,7170,688,12.12),
(20,7192,754,13.43),
(20,7241,622,14.42),
(20,7275,556,5.05),
(20,7287,622,1.60),
(20,7325,798,11.46),
(20,7371,1612,11.46),
(20,7394,754,7.84),
(20,7403,578,13.92),
(20,7499,578,13.43),
(20,7507,754,12.77),
(20,7518,974,10.14),
(20,7523,666,8.83),
(20,7541,1282,3.08),
(20,7606,1150,10.64),
(20,7613,1172,15.24),
(20,7694,578,4.23),
(20,7704,776,12.28),
(20,7760,798,5.71),
(20,7770,798,14.42),
(20,7784,666,14.42),
(20,7794,556,9.82),
(20,7826,556,12.12),
(20,7827,622,5.71),
(20,7856,842,5.71),
(20,7939,688,10.14),
(20,7951,1348,2.42),
(20,7962,1304,6.86),
(20,7984,622,8.50),
(20,8000,666,1.27),
(20,8003,622,3.41),
(20,8038,754,1.27),
(20,8145,666,13.59),
(20,8150,754,9.32),
(20,8151,798,5.05),
(20,8181,600,11.13),
(20,8211,622,3.41),
(20,8225,578,4.72),
(20,8271,886,3.24),
(20,8375,710,6.20),
(20,8389,1018,9.98),
(20,8416,556,6.36),
(20,8422,622,2.42),
(20,8426,688,5.71),
(20,8435,710,0.61),
(20,8458,820,12.44),
(20,8459,1084,5.21),
(20,8462,842,13.76),
(20,8489,578,4.06),
(20,8493,820,13.10),
(20,8497,688,3.24),
(20,8550,754,8.01),
(20,8578,556,15.73),
(20,8588,754,1.76),
(20,8600,556,4.39),
(20,8639,886,5.87),
(20,8650,666,11.46),
(20,8689,886,11.29),
(20,8697,688,5.87),
(20,8723,930,0.78),
(20,8755,1458,3.57),
(20,8808,556,5.05),
(20,8850,622,11.95),
(20,8856,1348,8.83),
(20,8868,556,5.54),
(20,8872,754,11.79),
(20,8880,1810,1.44),
(20,8881,886,9.98),
(20,8919,578,3.08),
(20,8920,688,3.08),
(20,9001,754,8.99),
(20,9013,1722,0.45),
(20,9119,622,11.29),
(20,9142,666,8.17),
(20,9145,754,15.40),
(20,9155,578,9.16),
(20,9233,1436,10.97),
(20,9256,886,13.92),
(20,9361,952,1.11),
(20,9368,556,6.86),
(20,9372,1018,12.77),
(20,9387,952,4.39),
(20,9394,798,2.75),
(20,9402,666,11.95),
(20,9416,1436,10.97),
(20,9432,600,13.76),
(20,9462,556,3.90),
(20,9501,622,15.24),
(20,9526,622,16.06),
(20,9555,578,8.34),
(20,9601,666,8.01),
(20,9659,710,11.13),
(20,9698,754,2.26),
(20,9780,600,13.10),
(20,9796,1150,8.34),
(20,9805,622,5.05),
(20,9865,886,14.58),
(20,9912,622,7.68),
(20,9934,622,8.83),
(20,9943,622,0.61),
(20,9966,952,13.27),
(20,9988,1150,8.01),
(20,9996,578,10.31),
(20,10014,666,6.20),
(20,10017,1700,4.72),
(20,10174,1062,11.46),
(20,10179,1018,4.39),
(20,10192,1018,4.56),
(20,10210,1524,2.09),
(20,10287,754,10.64),
(20,10306,666,4.23),
(20,10315,688,9.65),
(20,10333,600,1.60),
(20,10392,622,1.76),
(20,10481,710,15.89),
(20,10535,820,3.90),
(20,10540,622,15.57),
(20,10565,1128,8.01),
(20,10566,710,15.40),
(20,10581,1854,14.91),
(20,10620,754,15.89),
(20,10665,886,7.02),
(20,10676,754,14.25),
(20,10694,1524,13.76),
(20,10722,666,12.12),
(20,10821,1150,12.61),
(20,10844,1568,8.17),
(20,10848,1678,10.47),
(20,10973,1216,15.89),
(20,11007,710,6.86),
(20,11096,688,5.38),
(20,11125,622,8.17),
(20,11141,974,9.16),
(20,11172,578,6.36),
(20,11236,864,7.19),
(20,11285,710,13.10),
(20,11324,820,12.61),
(20,11335,1150,8.17),
(20,11340,1084,10.47),
(20,11391,1458,13.10),
(20,11410,622,12.77),
(20,11425,578,14.25),
(20,11426,556,5.21),
(20,11474,578,13.10),
(20,11477,622,16.22),
(20,11499,600,6.36),
(20,11516,578,8.99),
(20,11886,842,3.41),
(20,11912,1700,12.61),
(20,11954,1766,10.64),
(20,11983,578,1.76),
(20,11990,754,13.10),
(20,12024,1128,11.13),
(20,12076,622,8.01),
(20,12121,644,14.91),
(20,12161,1612,14.25),
(20,12192,754,13.59),
(20,12209,666,11.46),
(20,12216,820,1.27),
(20,12219,842,5.38),
(20,12246,578,10.31),
(20,12276,1260,4.39),
(20,12292,644,13.59),
(20,12369,754,2.26),
(20,12387,1018,6.20),
(20,12439,754,12.28),
(20,12445,842,12.44),
(20,12492,622,3.08),
(20,12560,644,1.60),
(20,12588,578,6.53),
(20,12594,930,12.94),
(20,12775,1128,13.43),
(20,12808,908,2.75),
(20,12812,952,1.27),
(20,12843,820,10.14),
(20,12863,842,15.57),
(20,12982,622,16.39),
(20,13049,578,1.27),
(20,13060,1084,15.24),
(20,13078,974,9.16),
(20,13086,644,8.34),
(20,13117,952,4.23),
(20,13132,798,2.09),
(20,13145,710,14.58),
(20,13177,556,2.59),
(20,13247,1150,10.14),
(20,13253,688,11.95),
(20,13264,578,6.69),
(20,13309,578,9.32),
(20,13351,622,5.87),
(20,13360,622,14.09),
(20,13379,578,2.91),
(20,13392,1172,9.98),
(20,13412,622,11.95),
(20,13424,1700,10.80),
(20,13459,710,1.11),
(20,13504,556,4.39),
(20,13523,666,14.42),
(20,13589,688,9.32),
(20,13594,688,1.11),
(20,13637,820,2.59),
(20,13664,952,8.17),
(20,13727,798,16.39),
(20,13746,776,13.92),
(20,13775,578,4.39),
(20,13806,1194,12.94),
(20,13820,688,3.41),
(20,13830,578,13.76),
(20,13848,1150,8.66),
(20,13871,644,1.11),
(20,13905,754,8.66),
(20,14116,556,13.10),
(20,14180,952,13.92),
(20,14360,666,12.44),
(20,14362,688,13.92),
(20,14392,578,11.79),
(20,14395,1216,13.59),
(20,14405,1018,4.39),
(20,14427,820,8.99),
(20,14430,578,10.14),
(20,14461,1106,1.11),
(20,14464,820,6.53),
(20,14486,820,9.98),
(20,14513,754,4.06),
(20,14553,710,4.23),
(20,14557,1568,15.57),
(20,14588,622,7.84),
(20,14599,688,10.14),
(20,14619,754,8.83),
(20,14695,622,15.73),
(20,14716,556,5.21),
(20,14737,798,12.77),
(20,14738,754,14.42),
(20,14815,1150,15.07),
(20,14848,622,6.04),
(20,14849,842,15.73),
(20,14960,556,13.10),
(20,14963,820,6.69),
(20,14968,886,8.01),
(20,14984,820,3.57),
(20,14986,886,3.90),
(20,15023,688,13.76),
(20,15049,1018,0.45),
(20,15052,930,0.78),
(20,15076,952,1.93),
(20,15079,622,7.02),
(20,15123,754,4.39),
(20,15154,754,0.45),
(20,15249,1392,12.44),
(20,15292,578,3.74),
(20,15442,556,2.26),
(20,15450,666,8.17),
(20,15478,556,15.73),
(20,15506,820,9.49),
(20,15516,820,13.59),
(20,15520,842,4.56),
(20,15563,930,5.54),
(20,15569,1084,16.39),
(20,15600,842,12.61),
(20,15638,798,3.57),
(20,15645,556,5.54),
(20,15705,886,14.58),
(20,15713,842,16.39),
(20,15737,1084,15.40),
(20,15742,622,8.01),
(20,15757,688,8.83),
(20,15823,732,6.36),
(20,15855,820,13.92),
(20,15890,578,2.75),
(20,15899,556,5.05),
(20,15951,556,1.44),
(20,15994,754,5.71),
(20,15999,820,13.59),
(20,16256,820,3.41),
(20,16285,1194,15.40),
(20,16291,1282,13.76),
(20,16292,754,12.61),
(20,16337,556,0.78),
(20,16358,820,8.01),
(20,16431,556,4.56),
(20,16436,842,12.77),
(20,16502,666,0.94),
(20,16549,600,3.90),
(20,16551,798,15.57),
(20,16598,710,12.61),
(20,16604,886,12.44),
(20,16614,710,10.14),
(20,16645,666,11.13),
(20,16687,556,9.65),
(20,16724,952,12.77),
(20,16754,842,2.75),
(20,16774,600,0.61),
(20,16802,886,7.19),
(20,16820,1018,7.35),
(20,16991,842,14.42),
(20,17110,622,13.10),
(20,17188,578,12.28),
(20,17248,578,2.59),
(20,17278,1040,15.07),
(20,17279,556,3.90),
(20,17330,688,11.79),
(20,17348,1744,3.08),
(20,17382,798,3.57),
(20,17428,600,1.76),
(20,17435,710,4.06),
(20,17456,1524,8.99),
(20,17545,952,5.38),
(20,17547,710,2.42),
(20,17566,754,2.75),
(20,17587,622,4.72),
(20,17676,600,0.78),
(20,17697,1524,6.69),
(20,17740,798,2.91),
(20,17779,798,13.76),
(20,17813,820,10.47),
(20,17840,952,8.34),
(20,17844,754,12.28),
(20,17855,666,3.08),
(20,17867,1150,1.27),
(20,17996,556,10.64),
(20,18140,688,0.45),
(20,18143,556,10.80),
(20,18207,1920,1.27),
(20,18229,1876,1.93),
(20,18246,622,15.73),
(20,18323,754,7.19),
(20,18346,974,0.94),
(20,18347,556,8.34),
(20,18376,622,6.20),
(20,18432,666,2.75),
(20,18468,622,13.92),
(20,18469,688,6.53),
(20,18479,754,2.91),
(20,18552,754,4.39),
(20,18610,1480,16.55),
(20,18626,930,12.61),
(20,18671,952,9.49),
(20,18673,622,9.82),
(20,18778,622,10.31),
(20,18788,578,7.35),
(20,18798,578,1.60),
(20,18818,996,0.78),
(20,18838,886,0.78),
(20,18888,1612,7.52),
(20,18891,688,9.32),
(20,18967,688,9.49),
(20,19001,578,12.12),
(20,19020,622,14.58),
(20,19029,622,5.21),
(20,19033,1920,5.21),
(20,19045,578,12.94),
(20,19093,1480,12.94),
(20,19239,842,11.46),
(20,19248,1348,9.32),
(20,19253,2250,10.14),
(20,19310,622,1.93),
(20,19339,842,2.09),
(20,19367,842,15.40),
(20,19369,952,10.97),
(20,19468,556,0.45),
(20,19475,578,5.54),
(20,19477,1018,10.31),
(20,19482,754,13.10),
(20,19524,710,5.38),
(20,19605,688,7.52),
(20,19624,1194,1.44),
(20,19641,930,14.25),
(20,19660,1018,10.80),
(20,19688,930,11.95),
(20,19762,1150,0.61),
(20,19768,1612,4.39),
(20,19806,556,4.56),
(20,19808,842,14.25),
(20,19812,600,2.42),
(20,19821,688,0.45),
(20,19904,622,13.10),
(20,20010,1480,15.07),
(20,20029,622,16.22),
(20,20044,974,12.77),
(20,20061,886,1.93),
(20,20084,556,0.45),
(20,20110,886,14.91),
(20,20182,1436,8.50),
(20,20313,578,9.65),
(20,20329,754,9.16),
(20,20349,842,6.20),
(20,20372,1062,6.36),
(20,20390,1084,9.82),
(20,20399,710,7.68),
(20,20401,732,7.52),
(20,20490,886,0.61),
(20,20524,1018,13.76),
(20,20543,578,3.24),
(20,20562,644,13.59),
(20,20633,1260,15.89),
(20,20660,710,14.42),
(20,20662,666,2.75),
(20,20684,622,13.43),
(20,20688,622,1.44),
(20,20716,622,5.21),
(20,20729,754,3.90),
(20,20730,1106,5.05),
(20,20776,622,12.12),
(20,20805,754,15.73),
(20,20825,1062,9.98),
(20,20845,688,12.61),
(20,20853,1744,11.13),
(20,20861,820,2.91),
(20,20874,578,4.23),
(20,20902,754,1.27),
(20,20904,688,14.25),
(20,20943,1480,10.14),
(20,20954,622,3.24),
(20,20984,666,12.44),
(20,21016,842,10.47),
(20,21103,1084,13.27),
(20,21117,842,7.52),
(20,21170,1678,2.59),
(20,21228,666,11.62),
(20,21263,754,4.72),
(20,21264,886,10.80),
(20,21266,578,3.57),
(20,21309,710,14.91),
(20,21345,556,4.72),
(20,21350,820,16.06),
(20,21358,622,6.04),
(20,21382,622,16.22),
(20,21469,1370,8.50),
(20,21473,1216,11.95),
(20,21482,842,12.28),
(20,21496,1128,14.25),
(20,21505,622,3.57),
(20,21550,952,11.95),
(20,21574,930,12.77),
(20,21644,578,1.93),
(20,21654,754,0.94),
(20,21722,644,14.25),
(20,21729,710,2.09),
(20,21771,622,10.14),
(20,21773,622,6.86),
(20,21810,710,8.01),
(20,21811,622,16.22),
(20,21901,666,12.44),
(20,21912,666,16.06),
(20,21923,622,14.74),
(20,22000,622,0.94),
(20,22083,1018,9.65),
(20,22091,688,12.44),
(20,22093,578,3.74),
(20,22180,754,3.24),
(20,22190,666,3.90),
(20,22231,556,1.93),
(20,22268,820,5.21),
(20,22280,1744,12.28),
(20,22281,1106,8.34),
(20,22320,622,5.38),
(20,22376,556,8.50),
(20,22391,820,6.86),
(20,22412,952,12.44),
(20,22501,644,7.19),
(20,22563,688,2.26),
(20,22603,1194,3.57),
(20,22605,754,8.34),
(20,22632,754,4.56),
(20,22673,1062,15.07),
(20,22679,578,5.54),
(20,22692,1150,15.57),
(20,22696,622,0.61),
(20,22702,622,1.93),
(20,22705,864,6.53),
(20,22748,754,4.72),
(20,22755,710,10.97),
(20,22817,644,2.91),
(20,22865,1128,4.06),
(20,22902,754,6.69),
(20,22922,688,5.05),
(20,22930,622,10.80),
(20,22949,1150,14.58),
(20,23018,710,14.74),
(20,23066,666,6.04),
(20,23102,578,6.20),
(20,23144,732,11.79),
(20,23149,1832,8.66),
(20,23161,2030,13.10),
(20,23191,1084,9.82),
(20,23213,754,1.60),
(20,23270,622,4.72),
(20,23289,1238,0.78),
(20,23303,952,6.69),
(20,23336,556,0.61),
(20,23365,600,2.26),
(20,23377,578,15.24),
(20,23381,1172,15.24),
(20,23410,886,2.59),
(20,23463,842,8.01),
(20,23478,666,9.82),
(20,23484,798,5.38),
(20,23503,666,9.32),
(20,23526,996,10.14),
(20,23556,622,1.76),
(20,23570,798,12.28),
(20,23628,556,9.65),
(20,23694,622,9.65),
(20,23795,666,10.31),
(20,23812,666,15.57),
(20,23816,798,4.56),
(20,23970,1128,13.27),
(20,24009,1348,12.12),
(20,24027,886,11.62),
(20,24053,622,12.44),
(20,24076,886,3.90),
(20,24111,688,15.89),
(20,24161,754,2.42),
(20,24174,1370,15.07),
(20,24185,1788,13.76),
(20,24206,600,3.57),
(20,24260,710,5.71),
(20,24309,1524,3.41),
(20,24327,842,4.23),
(20,24338,710,15.40),
(20,24345,952,1.44),
(20,24410,644,10.80),
(20,24431,556,14.42),
(20,24437,1326,5.54),
(20,24484,622,15.24),
(20,24505,886,14.42),
(20,24518,688,7.35),
(20,24547,578,14.09),
(20,24558,842,14.25),
(20,24562,798,11.46),
(20,24667,886,14.25),
(20,24693,688,12.28),
(20,24739,1106,4.23),
(20,24768,1084,8.50),
(20,24801,1018,16.06),
(20,24834,600,9.49),
(20,24855,688,3.90),
(20,24865,556,11.95),
(20,24914,622,15.24),
(20,24926,1480,7.35),
(20,24954,666,5.38),
(20,24969,1348,12.28),
(21,172,6,33.59),
(21,233,5,58.03),
(21,242,6,30.87),
(21,246,16,93.34),
(21,264,30,36.31),
(21,270,25,9.67),
(21,304,20,28.16),
(21,306,9,75.68),
(21,413,33,26.80),
(21,416,4,60.75),
(21,437,26,55.32),
(21,459,38,87.91),
(21,549,6,71.61),
(21,557,16,32.23),
(21,631,34,14.58),
(21,713,8,17.29),
(21,724,22,63.46),
(21,753,8,68.90),
(21,763,21,28.16),
(21,785,3,90.62),
(21,805,18,45.81),
(21,837,24,91.98),
(21,854,9,90.62),
(21,865,15,26.80),
(21,880,41,9.82),
(21,883,17,124.57),
(21,960,18,53.96),
(21,984,9,77.04),
(21,1000,3,63.46),
(21,1016,3,20.01),
(21,1055,6,96.05),
(21,1111,9,108.27),
(21,1177,30,134.07),
(21,1212,20,127.28),
(21,1216,9,100.13),
(21,1301,40,44.45),
(21,1331,15,132.72),
(21,1338,8,130.00),
(21,1363,3,70.25),
(21,1421,6,123.21),
(21,1432,22,132.72),
(21,1457,27,36.31),
(21,1499,32,53.96),
(21,1554,39,91.98),
(21,1600,24,10.51),
(21,1620,20,14.58),
(21,1633,15,51.24),
(21,1694,8,36.31),
(21,1825,15,113.71),
(21,1835,10,94.70),
(21,1894,34,14.75),
(21,1895,12,98.77),
(21,1921,20,59.39),
(21,1938,18,123.21),
(21,1960,12,44.45),
(21,1992,12,87.91),
(21,1995,4,83.83),
(21,1997,30,123.21),
(21,2001,22,51.24),
(21,2079,7,106.92),
(21,2083,21,124.57),
(21,2100,4,93.34),
(21,2117,10,15.94),
(21,2119,6,134.07),
(21,2141,10,78.40),
(21,2164,15,82.47),
(21,2178,12,5.07),
(21,2210,4,3.72),
(21,2229,3,53.96),
(21,2293,9,59.39),
(21,2299,21,77.04),
(21,2310,3,22.73),
(21,2313,12,64.82),
(21,2423,56,90.62),
(21,2424,12,36.31),
(21,2468,28,96.05),
(21,2480,9,3.72),
(21,2496,3,6.43),
(21,2498,62,49.88),
(21,2650,12,53.96),
(21,2652,21,5.07),
(21,2713,15,71.61),
(21,2725,14,3.72),
(21,2783,3,20.01),
(21,2877,23,11.91),
(21,2885,3,58.03),
(21,2919,4,63.46),
(21,2978,10,17.29),
(21,2998,14,134.07),
(21,3018,8,52.60),
(21,3069,4,85.19),
(21,3084,4,25.44),
(21,3131,48,51.24),
(21,3139,8,130.00),
(21,3250,48,108.27),
(21,3258,9,39.02),
(21,3294,14,58.03),
(21,3320,7,71.61),
(21,3358,4,21.37),
(21,3367,6,58.03),
(21,3421,46,87.91),
(21,3474,9,63.46),
(21,3477,4,87.91),
(21,3499,27,104.20),
(21,3501,11,125.93),
(21,3534,7,87.91),
(21,3573,12,98.77),
(21,3596,15,117.78),
(21,3620,3,97.41),
(21,3656,18,44.45),
(21,3730,41,6.83),
(21,3775,6,24.08),
(21,3916,14,34.95),
(21,3921,36,98.77),
(21,3940,21,47.17),
(21,3941,41,66.18),
(21,3975,38,14.75),
(21,3977,15,39.02),
(21,3987,12,43.09),
(21,4056,12,71.61),
(21,4129,6,128.64),
(21,4186,9,40.38),
(21,4237,3,32.23),
(21,4243,7,36.31),
(21,4250,14,98.77),
(21,4265,14,17.29),
(21,4305,23,5.34),
(21,4317,11,71.61),
(21,4324,4,105.56),
(21,4453,14,6.43),
(21,4500,46,64.82),
(21,4562,33,3.72),
(21,4570,8,90.62),
(21,4616,33,78.40),
(21,4642,10,49.88),
(21,4755,3,100.13),
(21,4789,3,3.72),
(21,4800,54,29.52),
(21,4827,7,53.96),
(21,4854,39,12.66),
(21,4903,4,71.61),
(21,4929,20,37.66),
(21,4968,12,55.32),
(21,4975,9,124.57),
(21,5024,26,14.00),
(21,5056,15,87.91),
(21,5101,62,41.74),
(21,5107,4,44.45),
(21,5110,3,17.29),
(21,5188,16,124.57),
(21,5222,9,5.07),
(21,5296,18,33.59),
(21,5299,9,14.58),
(21,5317,4,37.66),
(21,5324,6,109.63),
(21,5332,12,121.85),
(21,5375,5,39.02),
(21,5475,24,59.39),
(21,5483,4,22.73),
(21,5487,5,131.36),
(21,5516,10,52.60),
(21,5525,7,125.93),
(21,5574,29,110.99),
(21,5618,8,45.81),
(21,5631,18,78.40),
(21,5645,16,6.43),
(21,5662,6,43.09),
(21,5709,14,125.93),
(21,5722,18,24.08),
(21,5737,9,85.19),
(21,5761,30,7.79),
(21,5770,18,77.04),
(21,5790,28,78.40),
(21,5814,53,22.73),
(21,5843,4,72.97),
(21,5872,6,132.72),
(21,5886,6,125.93),
(21,5889,5,34.95),
(21,5890,5,45.81),
(21,5973,6,25.44),
(21,5977,12,20.01),
(21,6013,11,112.35),
(21,6028,12,32.23),
(21,6118,15,18.65),
(21,6126,53,6.38),
(21,6153,8,102.84),
(21,6188,24,45.81),
(21,6204,9,79.76),
(21,6225,6,72.97),
(21,6247,27,70.25),
(21,6276,3,34.95),
(21,6355,18,134.07),
(21,6362,21,101.48),
(21,6373,43,82.47),
(21,6431,12,45.81),
(21,6446,24,91.98),
(21,6480,3,102.84),
(21,6501,9,74.33),
(21,6511,15,135.43),
(21,6607,27,106.92),
(21,6692,10,25.44),
(21,6811,6,9.15),
(21,6818,26,52.60),
(21,6821,9,100.13),
(21,6838,3,18.65),
(21,6900,14,10.51),
(21,6935,30,48.53),
(21,7079,6,108.27),
(21,7146,24,12.66),
(21,7153,8,62.11),
(21,7154,21,77.04),
(21,7173,35,128.64),
(21,7200,9,24.08),
(21,7206,16,21.37),
(21,7209,15,64.82),
(21,7345,25,11.86),
(21,7411,10,128.64),
(21,7461,6,116.42),
(21,7669,3,132.72),
(21,7698,5,37.66),
(21,7712,9,97.41),
(21,7762,10,10.51),
(21,7796,14,130.00),
(21,7804,15,75.68),
(21,7805,3,6.43),
(21,7907,31,94.70),
(21,7910,12,44.45),
(21,7916,15,40.38),
(21,7917,9,29.52),
(21,7939,29,9.22),
(21,7983,7,71.61),
(21,8009,24,125.93),
(21,8024,6,113.71),
(21,8059,14,18.65),
(21,8084,6,59.39),
(21,8114,8,130.00),
(21,8129,14,10.51),
(21,8160,3,53.96),
(21,8170,12,66.18),
(21,8186,67,53.96),
(21,8229,7,112.35),
(21,8243,18,45.81),
(21,8276,3,124.57),
(21,8320,9,49.88),
(21,8348,5,66.18),
(21,8349,12,30.87),
(21,8413,22,110.99),
(21,8552,4,101.48),
(21,8582,24,110.99),
(21,8635,18,28.16),
(21,8639,38,5.34),
(21,8655,8,119.14)
go

Insert into tTMPAtualizaEstoque (iIDLoja, iIDLivro, nQuantidade, mValor)
values 
(21,8679,15,58.03),
(21,8702,9,39.02),
(21,8712,9,5.07),
(21,8731,4,44.45),
(21,8733,3,127.28),
(21,8758,6,101.48),
(21,8832,8,32.23),
(21,8861,9,83.83),
(21,9003,7,98.77),
(21,9024,47,132.72),
(21,9112,8,96.05),
(21,9125,15,81.12),
(21,9177,18,91.98),
(21,9194,27,14.58),
(21,9275,6,32.23),
(21,9283,8,123.21),
(21,9310,16,87.91),
(21,9311,14,90.62),
(21,9410,37,90.62),
(21,9551,16,15.94),
(21,9574,6,96.05),
(21,9616,14,66.18),
(21,9710,3,74.33),
(21,9712,12,44.45),
(21,9729,8,72.97),
(21,9739,10,29.52),
(21,9837,24,113.71),
(21,9858,6,71.61),
(21,9872,7,68.90),
(21,9891,24,45.81),
(21,9922,8,33.59),
(21,9955,18,128.64),
(21,9963,6,82.47),
(21,9965,6,102.84),
(21,9994,3,89.26),
(21,10009,6,11.86),
(21,10010,24,60.75),
(21,10051,16,48.53),
(21,10065,43,134.07),
(21,10182,27,135.43),
(21,10185,10,105.56),
(21,10218,6,34.95),
(21,10280,5,134.07),
(21,10316,9,29.52),
(21,10331,18,116.42),
(21,10334,16,18.65),
(21,10339,6,7.79),
(21,10381,10,10.51),
(21,10389,12,34.95),
(21,10476,12,75.68),
(21,10514,12,135.43),
(21,10556,16,33.59),
(21,10591,5,40.38),
(21,10617,6,116.42),
(21,10665,38,6.38),
(21,10693,68,64.82),
(21,10742,3,81.12),
(21,10782,21,28.16),
(21,10837,30,9.15),
(21,10854,7,30.87),
(21,10885,15,79.76),
(21,10897,6,98.77),
(21,10934,5,131.36),
(21,10949,21,100.13),
(21,10954,3,127.28),
(21,11083,21,39.02),
(21,11201,3,96.05),
(21,11206,9,63.46),
(21,11214,28,119.14),
(21,11234,6,97.41),
(21,11250,24,63.46),
(21,11276,6,108.27),
(21,11336,6,123.21),
(21,11419,8,62.11),
(21,11443,27,72.97),
(21,11476,7,7.79),
(21,11495,4,66.18),
(21,11502,21,13.22),
(21,11583,15,29.52),
(21,11626,3,131.36),
(21,11692,54,14.58),
(21,11755,3,9.15),
(21,11771,4,34.95),
(21,11861,9,59.39),
(21,11862,21,100.13),
(21,11886,36,3.10),
(21,11893,27,13.22),
(21,11939,3,128.64),
(21,12014,31,62.11),
(21,12021,20,94.70),
(21,12043,24,101.48),
(21,12048,24,5.07),
(21,12060,6,53.96),
(21,12067,3,97.41),
(21,12088,27,55.32),
(21,12122,4,36.31),
(21,12144,16,100.13),
(21,12242,12,5.07),
(21,12249,6,56.67),
(21,12292,27,12.36),
(21,12326,4,128.64),
(21,12334,15,22.73),
(21,12341,23,21.37),
(21,12360,15,135.43),
(21,12361,21,90.62),
(21,12378,25,131.36),
(21,12412,24,108.27),
(21,12500,39,75.68),
(21,12516,21,130.00),
(21,12536,12,52.60),
(21,12575,3,104.20),
(21,12583,33,15.94),
(21,12646,64,112.35),
(21,12688,3,62.11),
(21,12820,12,13.22),
(21,12831,10,113.71),
(21,12854,27,24.08),
(21,12877,43,13.22),
(21,12960,10,79.76),
(21,12993,18,87.91),
(21,13002,16,87.91),
(21,13009,9,49.88),
(21,13034,14,17.29),
(21,13060,47,13.85),
(21,13064,30,101.48),
(21,13069,3,20.01),
(21,13076,12,18.65),
(21,13122,15,30.87),
(21,13134,15,77.04),
(21,13153,6,81.12),
(21,13195,20,120.50),
(21,13255,10,125.93),
(21,13301,52,3.72),
(21,13305,3,132.72),
(21,13326,6,132.72),
(21,13509,24,105.56),
(21,13537,9,77.04),
(21,13605,15,9.15),
(21,13611,21,34.95),
(21,13629,3,81.12),
(21,13644,12,83.83),
(21,13645,30,68.90),
(21,13658,16,43.09),
(21,13721,8,79.76),
(21,13745,9,52.60),
(21,13793,3,49.88),
(21,13808,10,98.77),
(21,13838,3,11.86),
(21,13855,4,132.72),
(21,13912,3,26.80),
(21,13935,7,47.17),
(21,13949,15,110.99),
(21,13954,9,30.87),
(21,13971,21,3.72),
(21,13985,14,105.56),
(21,14036,44,37.66),
(21,14074,3,78.40),
(21,14106,8,98.77),
(21,14110,24,124.57),
(21,14113,12,51.24),
(21,14163,9,124.57),
(21,14235,6,125.93),
(21,14243,10,20.01),
(21,14253,20,3.72),
(21,14311,25,115.06),
(21,14404,12,29.52),
(21,14440,10,53.96),
(21,14446,10,86.55),
(21,14455,49,60.75),
(21,14458,9,29.52),
(21,14475,9,56.67),
(21,14498,3,18.65),
(21,14549,12,124.57),
(21,14728,21,47.17),
(21,14732,6,60.75),
(21,14780,18,24.08),
(21,14792,12,41.74),
(21,14823,21,60.75),
(21,14832,8,44.45),
(21,14848,26,5.49),
(21,14971,40,106.92),
(21,14973,8,78.40),
(21,14975,3,17.29),
(21,14991,18,26.80),
(21,15038,24,15.94),
(21,15061,8,41.74),
(21,15070,27,93.34),
(21,15127,16,52.60),
(21,15143,9,53.96),
(21,15167,6,119.14),
(21,15308,36,68.90),
(21,15337,4,17.29),
(21,15406,6,128.64),
(21,15510,6,22.73),
(21,15524,28,74.33),
(21,15559,21,21.37),
(21,15568,4,74.33),
(21,15650,21,96.05),
(21,15689,7,10.51),
(21,15722,13,130.00),
(21,15755,6,63.46),
(21,15776,6,86.55),
(21,15779,9,77.04),
(21,15802,6,119.14),
(21,15819,14,43.09),
(21,15868,8,105.56),
(21,15911,12,91.98),
(21,15942,6,17.29),
(21,15968,12,53.96),
(21,16044,4,105.56),
(21,16129,11,24.08),
(21,16140,25,28.16),
(21,16141,28,132.72),
(21,16164,12,91.98),
(21,16168,6,119.14),
(21,16338,21,132.72),
(21,16340,6,96.05),
(21,16353,24,11.86),
(21,16389,6,22.73),
(21,16463,5,104.20),
(21,16473,7,87.91),
(21,16706,18,40.38),
(21,16717,10,85.19),
(21,16728,10,94.70),
(21,16740,12,44.45),
(21,16778,30,3.72),
(21,16799,15,30.87),
(21,16809,21,11.86),
(21,16994,11,14.58),
(21,16996,12,87.91),
(21,17010,6,30.87),
(21,17024,9,49.88),
(21,17027,16,40.38),
(21,17111,3,98.77),
(21,17148,6,26.80),
(21,17159,15,90.62),
(21,17164,9,125.93),
(21,17212,9,36.31),
(21,17326,25,9.15),
(21,17353,9,83.83),
(21,17368,15,89.26),
(21,17383,12,24.08),
(21,17413,44,70.25),
(21,17414,20,55.32),
(21,17426,12,119.14),
(21,17472,7,52.60),
(21,17505,14,71.61),
(21,17521,20,86.55),
(21,17551,6,55.32),
(21,17569,18,72.97),
(21,17579,16,116.42),
(21,17591,4,51.24),
(21,17616,3,52.60),
(21,17634,6,20.01),
(21,17636,21,128.64),
(21,17656,8,106.92),
(21,17669,18,130.00),
(21,17702,35,105.56),
(21,17778,41,52.60),
(21,17801,16,108.27),
(21,17805,5,98.77),
(21,17886,10,77.04),
(21,17897,20,62.11),
(21,17961,18,66.18),
(21,17964,6,134.07),
(21,17975,24,22.73),
(21,17991,6,119.14),
(21,18039,6,44.45),
(21,18073,8,121.85),
(21,18086,9,7.79),
(21,18106,4,106.92),
(21,18152,36,79.76),
(21,18171,8,89.26),
(21,18172,21,124.57),
(21,18218,4,70.25),
(21,18257,4,115.06),
(21,18294,16,125.93),
(21,18302,6,59.39),
(21,18307,24,14.58),
(21,18335,5,33.59),
(21,18336,35,105.56),
(21,18348,28,87.91),
(21,18352,7,97.41),
(21,18364,12,29.52),
(21,18373,7,53.96),
(21,18535,24,78.40),
(21,18581,21,97.41),
(21,18586,21,58.03),
(21,18587,9,48.53),
(21,18627,12,78.40),
(21,18650,6,25.44),
(21,18684,5,5.07),
(21,18733,40,113.71),
(21,18768,3,14.58),
(21,18805,10,10.51),
(21,18852,4,128.64),
(21,18889,3,62.11),
(21,18953,7,119.14),
(21,19085,18,25.44),
(21,19125,7,72.97),
(21,19180,10,112.35),
(21,19215,35,135.43),
(21,19246,27,136.79),
(21,19326,21,97.41),
(21,19335,16,108.27),
(21,19518,12,70.25),
(21,19519,3,90.62),
(21,19531,9,135.43),
(21,19557,9,120.50),
(21,19619,6,40.38),
(21,19626,6,116.42),
(21,19666,32,70.25),
(21,19769,3,85.19),
(21,20036,26,10.51),
(21,20135,6,36.31),
(21,20256,5,96.05),
(21,20283,49,44.45),
(21,20303,6,36.31),
(21,20379,27,110.99),
(21,20382,8,66.18),
(21,20543,24,2.95),
(21,20562,27,12.36),
(21,20573,8,98.77),
(21,20581,16,3.72),
(21,20583,3,87.91),
(21,20612,12,106.92),
(21,20624,4,52.60),
(21,20736,16,78.40),
(21,20774,4,93.34),
(21,20826,5,37.66),
(21,20854,14,90.62),
(21,20905,15,105.56),
(21,20948,9,102.84),
(21,21008,7,85.19),
(21,21041,9,94.70),
(21,21080,14,10.51),
(21,21096,18,98.77),
(21,21114,27,116.42),
(21,21149,8,40.38),
(21,21171,4,36.31),
(21,21305,4,115.06),
(21,21412,18,123.21),
(21,21418,8,125.93),
(21,21433,6,51.24),
(21,21487,12,20.01),
(21,21507,26,68.90),
(21,21510,6,96.05),
(21,21611,14,112.35),
(21,21630,43,108.27),
(21,21674,4,52.60),
(21,21679,23,108.27),
(21,21809,26,113.71),
(21,21845,54,109.63),
(21,21873,4,125.93),
(21,21892,12,75.68),
(21,21924,6,21.37),
(21,21930,3,71.61),
(21,22037,9,60.75),
(21,22055,36,60.75),
(21,22083,44,8.77),
(21,22102,12,21.37),
(21,22104,10,37.66),
(21,22109,7,56.67),
(21,22164,10,102.84),
(21,22197,3,85.19),
(21,22225,27,9.15),
(21,22226,8,41.74),
(21,22246,12,37.66),
(21,22299,18,87.91),
(21,22314,6,101.48),
(21,22330,26,116.42),
(21,22345,5,41.74),
(21,22366,3,48.53),
(21,22404,3,98.77),
(21,22442,8,40.38),
(21,22470,12,39.02),
(21,22516,10,32.23),
(21,22536,18,131.36),
(21,22595,39,59.39),
(21,22618,7,53.96),
(21,22666,16,100.13),
(21,22708,30,64.82),
(21,22759,12,85.19),
(21,22834,16,108.27),
(21,22858,21,98.77),
(21,22877,10,17.29),
(21,22952,4,47.17),
(21,22973,7,34.95),
(21,22975,24,123.21),
(21,22976,18,66.18),
(21,22979,14,41.74),
(21,23063,57,55.32),
(21,23136,10,56.67),
(21,23143,21,13.22),
(21,23175,12,132.72),
(21,23177,4,90.62),
(21,23196,9,68.90),
(21,23265,9,62.11),
(21,23320,21,45.81),
(21,23361,12,37.66),
(21,23548,16,17.29),
(21,23549,4,120.50),
(21,23550,12,68.90),
(21,23565,8,91.98),
(21,23623,10,116.42),
(21,23646,12,128.64),
(21,23663,27,17.29),
(21,23682,12,77.04),
(21,23685,21,20.01),
(21,23687,47,104.20),
(21,23730,12,10.51),
(21,23772,5,121.85),
(21,23789,4,78.40),
(21,23895,31,67.54),
(21,23922,50,63.46),
(21,23927,8,81.12),
(21,23933,28,130.00),
(21,23967,8,58.03),
(21,24075,10,93.34),
(21,24128,6,47.17),
(21,24131,37,67.54),
(21,24203,12,43.09),
(21,24247,14,87.91),
(21,24270,18,44.45),
(21,24368,50,45.81),
(21,24370,16,11.86),
(21,24413,6,91.98),
(21,24422,4,102.84),
(21,24522,6,106.92),
(21,24533,24,60.75),
(21,24572,38,127.28),
(21,24573,8,48.53),
(21,24578,54,67.54),
(21,24585,12,62.11),
(21,24598,4,22.73),
(21,24616,12,108.27),
(21,24621,10,62.11),
(21,24639,18,60.75),
(21,24656,3,98.77),
(21,24685,17,52.60),
(21,24736,18,25.44),
(21,24848,10,21.37),
(21,24875,10,13.22),
(21,24943,8,34.95),
(22,108,3,49.88),
(22,159,38,14.30),
(22,182,9,104.20),
(22,225,76,132.72),
(22,234,62,83.83),
(22,246,3,93.34),
(22,252,7,77.04),
(22,257,61,17.29),
(22,264,8,36.31),
(22,274,3,123.21),
(22,308,103,106.92),
(22,345,3,78.40),
(22,370,90,132.72),
(22,388,72,68.90),
(22,395,85,136.79),
(22,412,90,121.85),
(22,418,44,41.74),
(22,545,65,70.25),
(22,612,4,52.60),
(22,625,135,104.20),
(22,670,107,63.46),
(22,676,14,117.78),
(22,678,102,20.01),
(22,683,10,44.45),
(22,691,79,93.34),
(22,710,91,100.13),
(22,720,63,108.27),
(22,741,9,60.75),
(22,891,17,62.11),
(22,990,82,130.00),
(22,1017,126,22.73),
(22,1062,28,110.99),
(22,1102,146,52.60),
(22,1223,12,94.70),
(22,1232,146,79.76),
(22,1254,26,14.58),
(22,1258,122,128.64),
(22,1287,65,108.27),
(22,1348,39,48.53),
(22,1361,59,116.42),
(22,1411,25,30.87),
(22,1419,48,44.45),
(22,1430,56,12.81),
(22,1433,7,85.19),
(22,1440,157,33.59),
(22,1458,105,59.39),
(22,1505,101,64.82),
(22,1568,9,22.73),
(22,1593,54,39.02),
(22,1611,54,63.46),
(22,1621,62,98.77),
(22,1665,38,59.39),
(22,1721,17,9.15),
(22,1730,58,82.47),
(22,1740,37,123.21),
(22,1787,31,125.93),
(22,1797,64,9.15),
(22,1803,71,82.47),
(22,1840,51,53.96),
(22,1855,118,49.88),
(22,1891,55,22.73),
(22,1972,59,97.41),
(22,1976,3,64.82),
(22,1986,6,87.91),
(22,2025,60,63.46),
(22,2038,102,20.01),
(22,2062,3,135.43),
(22,2080,71,135.43),
(22,2098,26,2.95),
(22,2102,24,63.46),
(22,2145,77,108.27),
(22,2176,143,55.32),
(22,2237,63,116.42),
(22,2323,73,127.28),
(22,2377,6,108.27),
(22,2380,143,110.99),
(22,2395,6,26.80),
(22,2434,127,87.91),
(22,2455,133,79.76),
(22,2460,63,70.25),
(22,2521,46,17.29),
(22,2578,70,70.25),
(22,2597,53,53.96),
(22,2600,70,93.34),
(22,2609,49,106.92),
(22,2615,3,90.62),
(22,2642,53,130.00),
(22,2666,56,21.37),
(22,2688,57,135.43),
(22,2712,75,106.92),
(22,2738,6,36.31),
(22,2765,23,124.57),
(22,2770,9,41.74),
(22,2813,10,112.35),
(22,2831,60,124.57),
(22,2874,61,41.74),
(22,2894,23,6.09),
(22,2907,76,63.46),
(22,2919,98,63.46),
(22,2923,39,134.07),
(22,3005,80,120.50),
(22,3008,119,21.37),
(22,3195,70,132.72),
(22,3233,111,44.45),
(22,3280,70,11.86),
(22,3309,58,7.79),
(22,3320,73,71.61),
(22,3410,53,135.43),
(22,3421,146,87.91),
(22,3509,42,94.70),
(22,3517,104,30.87),
(22,3543,3,124.57),
(22,3553,6,13.22),
(22,3568,45,36.31),
(22,3650,6,10.51),
(22,3670,25,77.04),
(22,3672,24,60.75),
(22,3695,77,97.41),
(22,3729,14,100.13),
(22,3783,41,59.39),
(22,3793,39,51.24),
(22,3801,9,17.29),
(22,3803,105,121.85),
(22,3825,96,89.26),
(22,3865,35,64.82),
(22,3886,70,119.14),
(22,3892,9,97.41),
(22,3961,45,87.91),
(22,3969,158,29.52),
(22,4017,103,72.97),
(22,4119,85,121.85),
(22,4199,163,96.05),
(22,4213,12,66.18),
(22,4223,59,56.67),
(22,4254,71,45.81),
(22,4269,102,108.27),
(22,4303,53,59.39),
(22,4448,95,67.54),
(22,4450,46,5.07),
(22,4499,136,9.15),
(22,4545,28,106.92),
(22,4612,148,11.86),
(22,4616,6,78.40),
(22,4651,107,117.78),
(22,4671,83,120.50),
(22,4756,3,135.43),
(22,4785,73,7.79),
(22,4860,70,115.06),
(22,4876,67,74.33),
(22,4893,37,90.62),
(22,4942,67,58.03),
(22,4986,47,78.40),
(22,4995,84,13.22),
(22,5029,12,26.80),
(22,5069,129,125.93),
(22,5083,29,106.92),
(22,5101,49,41.74),
(22,5141,66,105.56),
(22,5167,44,63.46),
(22,5177,101,3.72),
(22,5189,7,93.34),
(22,5213,151,128.64),
(22,5238,3,130.00),
(22,5281,5,13.22),
(22,5286,50,26.80),
(22,5318,6,113.71),
(22,5373,21,56.67),
(22,5437,80,70.25),
(22,5438,41,123.21),
(22,5486,15,63.46),
(22,5487,117,131.36),
(22,5535,107,110.99),
(22,5577,6,60.75),
(22,5600,96,109.63),
(22,5619,28,40.38),
(22,5673,14,106.92),
(22,5688,61,43.09),
(22,5721,12,106.92),
(22,5794,54,102.84),
(22,5816,77,75.68),
(22,5898,40,124.57),
(22,5912,81,91.98),
(22,5998,70,104.20),
(22,5999,58,115.06),
(22,6115,54,11.46),
(22,6118,9,18.65),
(22,6192,33,64.82),
(22,6225,109,72.97),
(22,6250,85,40.38),
(22,6314,119,75.68),
(22,6334,6,44.45),
(22,6348,99,82.47),
(22,6358,50,75.68),
(22,6533,81,43.09),
(22,6568,77,123.21),
(22,6608,18,7.79),
(22,6636,97,72.97),
(22,6676,60,85.19),
(22,6689,70,26.80),
(22,6711,155,94.70),
(22,6728,109,41.74),
(22,6766,61,121.85),
(22,6784,6,108.27),
(22,6834,66,67.54),
(22,6850,61,26.80),
(22,6867,88,15.94),
(22,6881,9,10.51),
(22,6957,65,82.47),
(22,6968,132,85.19),
(22,6970,95,48.53),
(22,7048,15,135.43),
(22,7064,69,97.41),
(22,7079,3,108.27),
(22,7145,139,13.22),
(22,7149,6,97.41),
(22,7175,41,63.46),
(22,7236,50,71.61),
(22,7266,39,102.84),
(22,7269,84,94.70),
(22,7286,142,93.34),
(22,7323,75,82.47),
(22,7347,44,53.96),
(22,7348,25,13.22),
(22,7365,106,41.74),
(22,7367,71,17.29),
(22,7389,77,22.73),
(22,7416,44,72.97),
(22,7430,51,30.87),
(22,7452,118,98.77),
(22,7524,73,37.66),
(22,7539,88,79.76),
(22,7548,63,128.64),
(22,7649,10,120.50),
(22,7683,67,82.47),
(22,7717,114,72.97),
(22,7730,77,56.67),
(22,7748,49,105.56),
(22,7840,99,58.03),
(22,7848,104,132.72),
(22,7878,88,101.48),
(22,7901,6,32.23),
(22,7952,55,128.64),
(22,7995,77,113.71),
(22,8033,34,9.15),
(22,8038,32,1.16),
(22,8234,15,41.74),
(22,8239,57,110.99),
(22,8242,69,72.97),
(22,8243,13,45.81),
(22,8270,32,127.28),
(22,8306,17,96.05),
(22,8316,69,110.99),
(22,8346,67,79.76),
(22,8376,87,102.84),
(22,8388,81,77.04),
(22,8490,87,30.87),
(22,8498,74,115.06),
(22,8534,9,67.54),
(22,8547,106,89.26),
(22,8596,55,72.97),
(22,8722,40,11.86),
(22,8749,6,7.79),
(22,8794,136,20.01),
(22,8873,95,49.88),
(22,8874,90,78.40),
(22,8911,92,63.46),
(22,8922,87,67.54),
(22,8954,104,55.32),
(22,9178,3,56.67),
(22,9217,130,11.86),
(22,9248,24,58.03),
(22,9340,90,25.44),
(22,9384,76,15.94),
(22,9398,3,25.44),
(22,9424,45,130.00),
(22,9427,105,125.93),
(22,9572,86,102.84),
(22,9574,54,96.05),
(22,9585,52,64.82),
(22,9588,74,81.12),
(22,9593,107,135.43),
(22,9645,52,132.72),
(22,9658,105,60.75),
(22,9677,13,70.25),
(22,9712,101,44.45),
(22,9714,15,13.22),
(22,9735,20,79.76),
(22,9804,86,97.41),
(22,9840,128,59.39),
(22,9878,65,49.88),
(22,9949,54,17.29),
(22,10065,137,134.07),
(22,10136,70,98.77),
(22,10235,69,90.62),
(22,10242,152,120.50),
(22,10246,48,10.51),
(22,10279,43,97.41),
(22,10306,28,3.84),
(22,10342,34,60.75),
(22,10405,78,102.84),
(22,10407,45,51.24),
(22,10509,11,59.39),
(22,10531,3,78.40),
(22,10540,26,14.15),
(22,10579,55,26.80),
(22,10596,136,15.94),
(22,10661,151,131.36),
(22,10697,5,78.40),
(22,10717,81,66.18),
(22,10767,40,11.86),
(22,10773,76,41.74),
(22,10939,58,30.87),
(22,10951,61,119.14),
(22,11137,20,68.90),
(22,11147,9,77.04),
(22,11251,73,37.66),
(22,11252,87,135.43),
(22,11268,62,5.07),
(22,11272,156,20.01),
(22,11317,33,40.38),
(22,11327,56,78.40),
(22,11337,113,10.51),
(22,11368,50,9.15),
(22,11438,6,96.05),
(22,11475,37,132.72),
(22,11498,122,29.52),
(22,11500,4,40.38),
(22,11569,54,28.16),
(22,11570,105,18.65),
(22,11580,109,52.60),
(22,11587,3,55.32),
(22,11730,118,67.54),
(22,11785,69,119.14),
(22,11809,101,89.26),
(22,11840,9,98.77),
(22,11842,131,47.17),
(22,11893,61,13.22),
(22,11942,26,67.54),
(22,11980,6,64.82),
(22,11982,68,29.52),
(22,12011,6,6.43),
(22,12033,38,123.21),
(22,12075,36,22.73),
(22,12083,105,97.41),
(22,12115,154,29.52),
(22,12120,48,91.98),
(22,12128,61,28.16),
(22,12138,82,75.68),
(22,12149,16,135.43),
(22,12171,21,64.82),
(22,12205,3,104.20),
(22,12320,70,89.26),
(22,12323,51,11.86),
(22,12361,12,90.62),
(22,12452,3,121.85),
(22,12488,8,44.45),
(22,12511,9,130.00),
(22,12534,122,47.17),
(22,12564,44,134.07),
(22,12604,124,104.20),
(22,12615,139,26.80),
(22,12681,91,113.71),
(22,12878,53,37.66),
(22,12936,79,36.31),
(22,12971,112,96.05),
(22,13002,24,87.91),
(22,13024,60,94.70),
(22,13050,79,43.09),
(22,13051,43,121.85),
(22,13132,34,1.90),
(22,13191,4,70.25),
(22,13241,52,93.34),
(22,13262,35,134.07),
(22,13273,6,26.80),
(22,13282,115,128.64),
(22,13305,9,132.72),
(22,13319,103,67.54),
(22,13373,12,22.73),
(22,13398,107,18.65),
(22,13406,53,5.07),
(22,13427,7,63.46),
(22,13436,80,117.78),
(22,13449,8,131.36),
(22,13484,73,83.83),
(22,13505,100,5.07),
(22,13513,20,58.03),
(22,13516,135,17.29),
(22,13522,145,127.28),
(22,13598,16,104.20),
(22,13599,97,104.20),
(22,13602,122,26.80),
(22,13694,93,110.99),
(22,13699,54,86.55),
(22,13844,127,52.60),
(22,13882,76,124.57),
(22,13890,15,120.50),
(22,13979,71,41.74),
(22,14021,113,45.81),
(22,14026,65,102.84),
(22,14034,62,90.62),
(22,14057,57,105.56),
(22,14180,41,12.66),
(22,14211,24,22.73),
(22,14256,58,102.84),
(22,14361,93,36.31),
(22,14420,68,77.04),
(22,14427,35,8.18),
(22,14446,52,86.55),
(22,14447,88,86.55),
(22,14459,27,37.66),
(22,14482,79,102.84),
(22,14600,111,113.71),
(22,14626,61,105.56),
(22,14656,128,40.38),
(22,14665,134,123.21),
(22,14707,108,13.22),
(22,14796,68,64.82),
(22,14814,58,59.39),
(22,14836,52,83.83),
(22,14898,48,41.74),
(22,14934,58,121.85),
(22,14952,49,47.17),
(22,15025,158,113.71),
(22,15032,19,5.07),
(22,15057,153,130.00),
(22,15083,146,14.58),
(22,15101,23,5.07),
(22,15121,74,124.57),
(22,15227,24,71.61),
(22,15230,132,58.03),
(22,15237,3,100.13),
(22,15248,52,86.55),
(22,15256,33,10.51),
(22,15264,62,132.72),
(22,15272,9,28.16),
(22,15391,112,21.37),
(22,15399,146,89.26),
(22,15414,6,21.37),
(22,15496,58,48.53),
(22,15502,143,9.15),
(22,15510,48,22.73),
(22,15516,35,12.36),
(22,15537,9,29.52),
(22,15654,31,101.48),
(22,15660,42,5.07),
(22,15666,55,9.15),
(22,15667,12,77.04),
(22,15687,59,60.75),
(22,15697,115,17.29),
(22,15762,52,33.59),
(22,15806,60,66.18),
(22,15885,8,55.32),
(22,15917,79,6.43),
(22,15918,12,5.07),
(22,15967,14,117.78),
(22,16005,3,60.75),
(22,16037,12,108.27),
(22,16053,6,24.08),
(22,16070,148,74.33),
(22,16145,65,9.15),
(22,16156,148,52.60),
(22,16181,29,131.36),
(22,16216,91,59.39),
(22,16237,56,40.38),
(22,16277,66,135.43),
(22,16308,76,71.61),
(22,16354,3,98.77),
(22,16357,15,66.18),
(22,16367,120,18.65),
(22,16432,61,48.53),
(22,16530,51,74.33),
(22,16531,3,101.48),
(22,16536,3,113.71),
(22,16561,13,13.22),
(22,16581,152,93.34),
(22,16623,88,40.38),
(22,16643,48,30.87),
(22,16680,9,63.46),
(22,16828,82,52.60),
(22,16848,10,93.34),
(22,16851,6,22.73),
(22,16887,74,82.47),
(22,16903,100,101.48),
(22,16938,6,91.98),
(22,17086,43,9.15),
(22,17089,3,43.09),
(22,17118,97,127.28),
(22,17187,86,15.94),
(22,17211,54,15.94),
(22,17232,72,85.19),
(22,17234,98,132.72),
(22,17240,159,67.54),
(22,17276,27,93.34),
(22,17279,23,3.55),
(22,17323,51,68.90),
(22,17377,79,15.94),
(22,17431,40,91.98),
(22,17510,16,128.64),
(22,17511,42,83.83),
(22,17547,30,2.20),
(22,17582,32,45.81),
(22,17596,53,52.60),
(22,17605,85,44.45),
(22,17624,78,68.90),
(22,17713,56,72.97),
(22,17727,3,93.34),
(22,17739,64,3.72),
(22,17768,48,75.68),
(22,17782,121,112.35),
(22,17798,151,106.92),
(22,17799,128,106.92),
(22,17810,88,121.85),
(22,17830,20,66.18),
(22,17855,28,2.80),
(22,17878,6,89.26),
(22,17905,48,125.93),
(22,17922,99,75.68),
(22,17980,9,98.77),
(22,18055,49,15.94),
(22,18056,75,36.31),
(22,18127,67,127.28),
(22,18154,85,33.59),
(22,18219,96,72.97),
(22,18226,9,14.58),
(22,18234,123,109.63),
(22,18261,132,25.44),
(22,18364,21,29.52),
(22,18387,64,53.96),
(22,18402,66,48.53),
(22,18420,6,90.62),
(22,18442,123,93.34),
(22,18459,115,135.43),
(22,18460,79,105.56),
(22,18470,156,39.02),
(22,18505,40,135.43),
(22,18556,128,26.80),
(22,18559,19,33.59),
(22,18566,84,37.66),
(22,18595,70,93.34),
(22,18623,12,66.18),
(22,18648,71,79.76),
(22,18675,62,70.25),
(22,18677,37,83.83),
(22,18845,74,125.93),
(22,18874,75,14.58),
(22,18903,86,117.78),
(22,18991,142,30.87),
(22,18999,24,15.94),
(22,19010,6,77.04),
(22,19028,101,59.39),
(22,19127,14,70.25),
(22,19162,109,127.28),
(22,19170,13,60.75)
go

Insert into tTMPAtualizaEstoque (iIDLoja, iIDLivro, nQuantidade, mValor)
values 
(22,19189,107,115.06),
(22,19211,52,11.86),
(22,19218,46,59.39),
(22,19282,10,20.01),
(22,19285,100,33.59),
(22,19309,72,104.20),
(22,19336,16,74.33),
(22,19347,105,75.68),
(22,19382,141,9.15),
(22,19396,12,110.99),
(22,19458,143,21.37),
(22,19471,44,25.44),
(22,19543,137,116.42),
(22,19545,50,59.39),
(22,19571,113,77.04),
(22,19589,15,82.47),
(22,19591,146,56.67),
(22,19672,143,34.95),
(22,19675,9,41.74),
(22,19684,43,127.28),
(22,19768,71,3.99),
(22,19769,78,85.19),
(22,19817,132,108.27),
(22,19901,3,86.55),
(22,19911,37,41.74),
(22,19936,66,128.64),
(22,19949,3,29.52),
(22,19972,111,30.87),
(22,19991,87,9.15),
(22,19992,5,132.72),
(22,20013,12,68.90),
(22,20026,87,49.88),
(22,20029,26,14.75),
(22,20075,83,48.53),
(22,20081,18,125.93),
(22,20100,12,11.86),
(22,20102,149,116.42),
(22,20113,81,121.85),
(22,20121,51,79.76),
(22,20162,13,116.42),
(22,20227,129,81.12),
(22,20291,100,87.91),
(22,20309,25,11.86),
(22,20328,50,98.77),
(22,20336,6,74.33),
(22,20488,74,97.41),
(22,20491,35,15.94),
(22,20522,98,127.28),
(22,20523,8,127.28),
(22,20541,112,14.58),
(22,20544,9,10.51),
(22,20545,39,43.09),
(22,20555,37,90.62),
(22,20562,27,12.36),
(22,20608,54,58.03),
(22,20633,55,14.45),
(22,20673,44,33.59),
(22,20693,67,30.87),
(22,20719,55,18.65),
(22,20756,70,78.40),
(22,20757,48,130.00),
(22,20765,16,24.08),
(22,20775,18,94.70),
(22,20795,6,124.57),
(22,20810,137,30.87),
(22,20832,93,124.57),
(22,20956,46,49.88),
(22,20983,34,71.61),
(22,20986,51,70.25),
(22,20992,127,97.41),
(22,21061,68,63.46),
(22,21068,65,71.61),
(22,21082,9,60.75),
(22,21124,3,98.77),
(22,21133,67,109.63),
(22,21160,27,21.37),
(22,21216,82,5.07),
(22,21264,38,9.82),
(22,21291,8,131.36),
(22,21292,125,56.67),
(22,21295,26,55.32),
(22,21317,56,30.87),
(22,21352,55,104.20),
(22,21374,63,14.58),
(22,21383,91,124.57),
(22,21424,52,62.11),
(22,21542,27,78.40),
(22,21558,40,20.01),
(22,21638,84,68.90),
(22,21648,103,104.20),
(22,21719,107,58.03),
(22,21755,101,94.70),
(22,21814,101,13.22),
(22,21816,59,87.91),
(22,21828,6,100.13),
(22,21850,79,67.54),
(22,21851,122,3.72),
(22,21874,15,79.76),
(22,21875,6,89.26),
(22,21887,6,43.09),
(22,21904,106,79.76),
(22,21938,35,67.54),
(22,21971,85,71.61),
(22,22051,82,77.04),
(22,22114,102,124.57),
(22,22135,111,109.63),
(22,22147,14,79.76),
(22,22194,137,53.96),
(22,22216,83,7.79),
(22,22236,42,62.11),
(22,22241,6,71.61),
(22,22255,80,109.63),
(22,22263,16,9.15),
(22,22265,96,127.28),
(22,22312,106,134.07),
(22,22322,43,116.42),
(22,22330,90,116.42),
(22,22336,60,9.15),
(22,22351,85,58.03),
(22,22393,130,108.27),
(22,22435,126,21.37),
(22,22450,5,6.43),
(22,22627,3,45.81),
(22,22632,32,4.14),
(22,22708,12,64.82),
(22,22715,119,21.37),
(22,22766,6,109.63),
(22,22806,51,135.43),
(22,22827,102,85.19),
(22,22854,89,134.07),
(22,22883,80,74.33),
(22,22902,32,6.09),
(22,22950,24,43.09),
(22,22958,118,113.71),
(22,23098,95,75.68),
(22,23106,136,11.86),
(22,23241,64,91.98),
(22,23250,62,58.03),
(22,23321,112,125.93),
(22,23349,81,24.08),
(22,23376,55,3.72),
(22,23467,112,9.15),
(22,23503,28,8.47),
(22,23574,67,115.06),
(22,23587,3,25.44),
(22,23603,52,89.26),
(22,23642,6,115.06),
(22,23669,3,45.81),
(22,23707,99,120.50),
(22,23721,87,18.65),
(22,23753,28,101.48),
(22,23832,152,18.65),
(22,23834,6,130.00),
(22,23841,128,24.08),
(22,23857,35,24.08),
(22,23900,26,120.50),
(22,23926,47,116.42),
(22,23960,82,113.71),
(22,23971,71,63.46),
(22,24065,42,25.44),
(22,24091,46,62.11),
(22,24140,57,71.61),
(22,24183,6,48.53),
(22,24213,66,115.06),
(22,24263,56,85.19),
(22,24283,88,26.80),
(22,24288,112,60.75),
(22,24348,18,56.67),
(22,24396,43,58.03),
(22,24409,49,131.36),
(22,24443,123,68.90),
(22,24448,60,87.91),
(22,24451,74,53.96),
(22,24460,75,128.64),
(22,24494,67,3.72),
(22,24567,77,109.63),
(22,24592,57,94.70),
(22,24634,9,5.07),
(22,24769,11,119.14),
(22,24780,87,45.81),
(22,24837,22,18.65),
(22,24858,110,106.92),
(22,24861,75,5.07),
(22,24872,102,21.37),
(22,24940,3,96.05),
(22,24959,153,62.11)
go

Update tTMPAtualizaEstoque 
   Set nQuantidade += 10 , -- Aumenta a quantidade em mais 10 unidades 
       mValor *= 1.10      -- Aumente o valor em 10% 



/*
Alterar o tipo de dados dtAtualizaEstoque para incluir a coluna iidLoja. 
*/
use eBook
go

Drop Procedure stp_AtualizaEstoque
go

Drop Type dtAtualizaEstoque 
go

Create Type dtAtualizaEstoque 
As Table 
(   
   iiDLoja int not null ,
   iIDLivro int not null,
   nQuantidade int not null,
   mValor smallmoney not null 
)
go

/*
Como o ID da Loja está dentro da tabela com o dados da planilha,
não precisamos mais do parâmetro @iIDLoja 
*/


/*------------------------------------------------------------
Autor      : Wolney M. Maia
Objeto     : stp_AtualizaEstoque 
Objetivo   : Atualiza a quantidade e valor de vários livros para uma
             determinada loja. 
             Retorna um conjunto de dados com os valores atualizados
             no formato JSON 

Histórico:        
Autor                  IDBug Data       Descrição        
---------------------- ----- ---------- --------------------
Wolney M. Maia               01/01/2019 Criação da Procedure 
Wolney M. Maia               05/04/2019 O Id da loja agora está dentro
                                        do parâmetro de valor de tabela 
------------------------------------------------------------*/
Create or Alter Procedure stp_AtualizaEstoque 
@tAtualizaEstoque dtAtualizaEstoque READONLY,
@jEstoqueAtualizado varchar(max) OUTPUT 
as
Begin

   Set nocount on 

   Declare @nRetorno int = 0 

   Begin Try

      Update tRELEstoque 
         Set nQuantidade += tAtualizaEstoque.nQuantidade ,
             mValor = tAtualizaEstoque.mValor 
        From tRELEstoque 
        Join @tAtualizaEstoque as tAtualizaEstoque
          on tRELEstoque.iIDLivro = tAtualizaEstoque.iIDLivro
         and tRELEstoque.iIDLoja = tAtualizaEstoque.iiDLoja
      
      if @@rowcount = 0
         Raiserror('Não houve livros para atualizar o estoque.',16,1)

      Set @jEstoqueAtualizado = (Select Estoque.iIDLoja,
                                        Estoque.iIDLivro,
                                        Estoque.nQuantidade, 
                                        Estoque.mValor
                                   From tRELEstoque as Estoque 
                                   Join @tAtualizaEstoque as tAtualizaEstoque
                                     on Estoque.iIDLivro = tAtualizaEstoque.iIDLivro
                                    and Estoque.iIDLoja = tAtualizaEstoque.iiDLoja
                                    For Json Auto -->> 
                                )

       
   End Try 

   Begin Catch 

      Execute @nRetorno = stp_ManipulaErro

   End Catch 

   Return @nRetorno

End 
/*
*/
go


Select iIDLivro,nQuantidade,mValor,iidLoja
  From tTMPAtualizaEstoque 

Begin Transaction 

Select iIDLoja, count(1) , sum(mValor) 
  From tRELEstoque 
 Where iIDLoja in  (20,21,22) 
 Group by iIDLoja

-- Declare a variavel tabela igual ao tipo de dados tabela. 
Declare @tTMPItensEnviados dtAtualizaEstoque 
Declare @jEstoqueRetorno varchar(max) = ''

-- Inserir os dados enviados para essa variável 
Insert Into @tTMPItensEnviados (iIDLivro,nQuantidade,mValor,iiDLoja)
Select iIDLivro,nQuantidade,mValor,iidLoja
  From tTMPAtualizaEstoque 

Declare @iidLoja int = 20 
Declare @nStatus int = 0

Execute @nStatus = stp_AtualizaEstoque  @tAtualizaEstoque = @tTMPItensEnviados,
                                        @jEstoqueAtualizado = @jEstoqueRetorno  OUTPUT 

if @nStatus = 0 Begin 

   Select iIDLoja, count(1) , sum(mValor) 
     From tRELEstoque 
    Where iIDLoja in  (20,21,22) 
    Group by iIDLoja

   Select * 
     From OpenJson (@jEstoqueRetorno)
     With (iIDLoja int '$.iIDLoja' ,
           iIDLivro int '$.iIDLivro' ,
           nQuantidade int '$.nQuantidade', 
           mValor smallmoney '$.mValor'
          )

   Commit 
End 
Else Begin 
   Rollback 
   Select * from vLOGEventos where iIDEvento = @nStatus
End 
go 


/*
Retornar um segundo conjunto de dados que representa o valor total
do estoque para cada Loja 
*/

/*------------------------------------------------------------
Autor      : Wolney M. Maia
Objeto     : stp_AtualizaEstoque 
Objetivo   : Atualiza a quantidade e valor de vários livros para uma
             determinada loja. 
             Retorna um conjunto de dados com os valores atualizados
             no formato JSON 

Histórico:        
Autor                  IDBug Data       Descrição        
---------------------- ----- ---------- --------------------
Wolney M. Maia               01/01/2019 Criação da Procedure 
Wolney M. Maia               05/04/2019 O Id da loja agora está dentro
                                        do parâmetro de valor de tabela 
------------------------------------------------------------*/
Create or Alter Procedure stp_AtualizaEstoque 
@tAtualizaEstoque dtAtualizaEstoque READONLY,
@jEstoqueAtualizado varchar(max) OUTPUT,
@jValorDoEstoque varchar(max) OUTPUT 
as
Begin

   Set nocount on 

   Declare @nRetorno int = 0 -- Retorna o status da procedure 

   Begin Try

      /*
      Adiciona a quantidade e atualiza o valor de cada livro 
      */
      Update tRELEstoque 
         Set nQuantidade += tAtualizaEstoque.nQuantidade ,
             mValor = tAtualizaEstoque.mValor 
        From tRELEstoque 
        Join @tAtualizaEstoque as tAtualizaEstoque
          on tRELEstoque.iIDLivro = tAtualizaEstoque.iIDLivro
         and tRELEstoque.iIDLoja = tAtualizaEstoque.iiDLoja
      
      If @@rowcount = 0
         Raiserror('Não houve livros para atualizar o estoque.',16,1)
      
      /*
      Recupera os dados que foram atualizados e transforma no formato JSON 
      */
      Set @jEstoqueAtualizado = (Select Estoque.iIDLoja,
                                        Estoque.iIDLivro,
                                        Estoque.nQuantidade, 
                                        Estoque.mValor
                                   From tRELEstoque as Estoque 
                                   Join @tAtualizaEstoque as tAtualizaEstoque
                                     on Estoque.iIDLivro = tAtualizaEstoque.iIDLivro
                                    and Estoque.iIDLoja = tAtualizaEstoque.iiDLoja
                                    For Json Auto -->> 
                                )
      /*
      Recupera o valor total do estoque e a quantidade de itens para cada loja 
      e transforma no formato JSON 
      */
      Set @jValorDoEstoque = (Select Loja.iIDLoja,
                                     Loja.cDescricao, 
                                     count(1) as nQtdItens, 
                                     sum(Estoque.mValor) as mValorEstoque 
                                From tCADLoja as Loja       
                                Join tRELEstoque as Estoque
                                  on Loja.iIDLoja = Estoque.iIDLoja
                                Join @tAtualizaEstoque as tAtualizaEstoque
                                  on Estoque.iIDLivro = tAtualizaEstoque.iIDLivro
                                 and Estoque.iIDLoja = tAtualizaEstoque.iiDLoja
                               Group by Loja.iIDLoja,Loja.cDescricao
                                 For Json Auto -->> 
                             )
   End Try 

   Begin Catch 

      Execute @nRetorno = stp_ManipulaErro

   End Catch 

   Return @nRetorno

End 
/*
*/

Update tTMPAtualizaEstoque 
   Set nQuantidade += 10 , -- Aumenta a quantidade em mais 10 unidades 
       mValor *= 1.10      -- Aumente o valor em 10% 



Begin Transaction 

Select iIDLoja, count(1) , sum(mValor) 
  From tRELEstoque 
 Where iIDLoja in  (20,21,22) 
 Group by iIDLoja

-- Declare a variável tabela igual ao tipo de dados tabela. 
Declare @tTMPItensEnviados dtAtualizaEstoque 
Declare @jEstoqueRetorno varchar(max) = ''
Declare @jValorRetorno varchar(max) = ''

-- Inserir os dados enviados para essa variável 
Insert Into @tTMPItensEnviados (iIDLivro,nQuantidade,mValor,iiDLoja)
Select iIDLivro,nQuantidade,mValor,iidLoja
  From tTMPAtualizaEstoque 

Declare @iidLoja int = 20 
Declare @nStatus int = 0

Execute @nStatus = stp_AtualizaEstoque  @tAtualizaEstoque   = @tTMPItensEnviados,
                                        @jEstoqueAtualizado = @jEstoqueRetorno  OUTPUT ,
                                        @jValorDoEstoque    = @jValorRetorno OUTPUT 

if @nStatus = 0 Begin 

   Select * 
     From OpenJson (@jEstoqueRetorno)
     With (iIDLoja int '$.iIDLoja' ,
           iIDLivro int '$.iIDLivro' ,
           nQuantidade int '$.nQuantidade', 
           mValor smallmoney '$.mValor'
          )

   Select * 
     From OpenJson (@jValorRetorno)
     With (iIDLoja int '$.iIDLoja' ,
           cDescricao varchar(50) '$.cDescricao',
           nQtdItens int  '$.nQtdItens ',
           mValorEstoque smallmoney  '$.mValorEstoque'
          )
     Order by iIDLoja

   Commit 
End 
Else Begin 
   Rollback 
   Select * from vLOGEventos where iIDEvento = @nStatus
End 
go 

/*
UFA!!!!!
*/